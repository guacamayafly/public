
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>Guacamayafly Booking Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: "Inter", sans-serif;
    }
    /* Scrollbar hidden for timer */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    /* Styles for payment options from nuevoindex.html */
    .payment-option {
        border: 1px solid #e5e7eb;
        padding: 0.75rem;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    .payment-option:hover {
        border-color: #FF7F00;
        background-color: #fff7ed;
    }
    .payment-option.selected {
        border-color: #FF7F00;
        background-color: #fff7ed;
        box-shadow: 0 0 0 2px #FF7F00;
    }
    .payment-logo {
        height: 24px;
    }

    /* Calendar Modal Styles from nuevoindex.html */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0,0,0,0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 5000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    .modal-overlay.visible {
        opacity: 1;
        pointer-events: auto;
    }
    .modal-container {
        background-color: white;
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        width: 90%;
        max-width: 800px;
        transform: scale(0.95);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
    }
    .modal-overlay.visible .modal-container {
        transform: scale(1);
    }
    .calendar-modal .modal-container {
        padding: 0;
        max-height: 90vh;
        overflow: hidden;
        max-width: 400px;
    }
    .calendar-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
    }
    .calendar-modal-top-info {
        display: flex;
        justify-content: space-around;
        padding: 0.5rem 1rem;
        background-color: #f9fafb;
    }
    .info-box {
        text-align: center;
        padding: 0.5rem;
        border-radius: 0.5rem;
        flex: 1;
    }
    .info-box span {
        display: block;
    }
    .info-box .label {
        font-size: 0.75rem;
        color: #6b7280;
    }
    .info-box .value {
        font-weight: 600;
    }
    .calendar-modal-body {
        padding: 1rem;
        overflow-y: auto;
    }
    .calendar-modal-footer {
        padding: 1rem;
        border-top: 1px solid #e5e7eb;
        background-color: white;
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
    }
    .price-legend {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1rem;
        font-size: 0.8rem;
    }
    .price-legend > div { display: flex; align-items: center; gap: 0.5rem; }
    .price-legend .color-box { width: 1rem; height: 1rem; border-radius: 0.25rem; }
    .quick-select-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }
    .quick-select-buttons button {
        flex: 1;
        padding: 0.5rem;
        border: 1px solid #d1d5db;
        border-radius: 9999px;
        background-color: white;
        cursor: pointer;
        font-weight: 600;
    }
    .quick-select-buttons button:hover { background-color: #f3f4f6; }

    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .calendar-months { display: grid; grid-template-columns: 1fr; gap: 2rem; }
    @media (min-width: 768px) { .calendar-months { grid-template-columns: 1fr 1fr; } }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem; place-items: center; }
    .calendar-day { width: 38px; height: 38px; display: flex; justify-content: center; align-items: center; border-radius: 50%; cursor: pointer; transition: all 0.2s; }
    .calendar-day.weekday { font-weight: 600; font-size: 0.8rem; color: #4a5568; cursor: default; }
    .calendar-day.disabled { color: #cbd5e0; cursor: not-allowed; text-decoration: line-through; }
    .calendar-day:not(.disabled):not(.weekday):hover { background-color: #f0f0f0; }
    .calendar-day.price-cheap { background-color: #d1fae5; color: #065f46; }
    .calendar-day.price-medium { background-color: #fef3c7; color: #92400e; }
    .calendar-day.price-expensive { background-color: #fee2e2; color: #991b1b; }
    .calendar-day.selected { background-color: #2563eb !important; color: white !important; font-weight: bold; }
    .calendar-day.in-range { background-color: #dbeafe; border-radius: 0; }
    .calendar-day.range-start { border-top-left-radius: 50%; border-bottom-left-radius: 50%; }
    .calendar-day.range-end { border-top-right-radius: 50%; border-bottom-right-radius: 50%; }

    /* Notification Popup */
    #notification-container { position: fixed; top: 20px; right: 20px; z-index: 10000; }
    .notification-popup { background-color: #ef4444; color: white; padding: 1rem 1.5rem; border-radius: 0.5rem; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateX(120%); transition: transform 0.5s ease-in-out; margin-top: 10px; }
    .notification-popup.show { transform: translateX(0); }

    /* Pop-up de Sitio en Desarrollo */
    #development-popup-overlay {
        position: fixed;
        inset: 0;
        background-color: rgba(0,0,0,0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 12000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
    }
    #development-popup-overlay.visible {
        opacity: 1;
        pointer-events: auto;
    }
    #development-popup-overlay .modal-container { /* Use the existing modal-container style */
        background-color: white;
        padding: 2rem;
        border-radius: 0.75rem;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        width: 90%;
        max-width: 400px;
        transform: scale(0.95);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        text-align: center;
    }
    #development-popup-overlay.visible .modal-container {
        transform: scale(1);
    }

    /* Sticky footer button styles */
    #sticky-reserve-btn-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: white;
        padding: 0.5rem 1.5rem;
        box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
        z-index: 900;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        transition: transform 0.3s ease-in-out;
    }

    #sticky-reserve-btn-container.hidden {
        transform: translateY(100%);
    }

    #sticky-reserve-btn {
        width: 100%;
        background-color: #0d6efd;
        color: white;
        font-size: 1.125rem;
        font-weight: bold;
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        transition: background-color 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    #sticky-reserve-btn:hover {
        background-color: #0b5ed7;
    }

    #sticky-reserve-info {
        font-size: 0.75rem;
        color: #6b7280;
        text-align: center;
    }

    /* Adjust main content padding when sticky button is visible */
    body.has-sticky-footer #main-content {
        padding-bottom: 8rem;
    }

    /* Specific date display adjustments for mobile */
    #date-display-block {
      display: grid;
      grid-template-columns: 1fr auto 1fr auto;
      align-items: center;
      gap-x: 0.5rem;
    }

    #date-display-block .header-cell {
        font-size: 0.75rem;
        color: #6b7280;
        font-weight: 600;
    }

    #date-display-block .date-details {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    #date-display-block .nights-count {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      flex-shrink: 0;
    }

    /* Hide arrow on larger screens if desired, but screenshot shows it */
    @media (min-width: 640px) {
        #date-display-block {
            grid-template-columns: 1fr auto 1fr auto;
        }
    }
  </style>
</head>
<body class="bg-[#f7f8fa] text-[#222222] has-sticky-footer">
  <!-- Pop-up de Sitio en Desarrollo -->
  <div id="development-popup-overlay" class="modal-overlay hidden">
      <div class="modal-container">
          <div class="text-yellow-500 mb-4">
              <i class="fas fa-exclamation-triangle fa-3x"></i>
          </div>
          <h2 class="text-2xl font-bold mb-2 text-gray-800">Sitio Web en Desarrollo</h2>
          <p class="text-gray-600 mb-6">
              Los precios mostrados son de prueba y este sitio web est√° actualmente en desarrollo. Por favor, consulte con un agente antes de realizar cualquier pago o reserva.
          </p>
          <button id="development-popup-close" class="bg-blue-600 text-white font-semibold px-8 py-2 rounded-lg hover:bg-blue-700 transition-colors">
              Entendido
          </button>
      </div>
  </div>

  <!-- Header -->
  <header class="bg-white border-b border-gray-200">
    <!-- Adjusted header container for mobile: flex-col on small screens -->
    <div
      class="max-w-[1200px] mx-auto px-3 py-3 sm:px-6 flex flex-col sm:flex-row items-center justify-between relative"
    >
      <!-- Login/Avatar Container (Top-right on mobile, relative on larger screens) -->
      <div id="auth-status-container" class="absolute top-3 right-3 sm:relative sm:top-0 sm:right-0 sm:order-last">
        <!-- Content will be dynamically loaded here by JS -->
      </div>

      <!-- Guacamayafly Logo (Centered on mobile, normal on larger screens) -->
      <div class="flex items-center space-x-2 mb-4 sm:mb-0 mx-auto sm:mx-0">
          <img alt="Logo Guacamayafly" height="32" src="https://guacamayafly.github.io/public/assets/img/logo-6.svg" width="32"/>
          <span class="font-extrabold text-lg select-none text-guacamayafly-orange">GUACAMAYAFLY</span>
      </div>

      <!-- Progress Steps (Below logo on mobile, centered; normal on larger screens) -->
      <nav class="flex items-start relative flex-1 justify-center w-full sm:w-auto mt-2 sm:mt-0">
        <!-- Horizontal Line for progress bar -->
        <div class="absolute w-full h-0.5 bg-gray-300 top-[12px] left-0 right-0"></div>
        <!-- Blue progress fill line (adjust width based on current step) -->
        <div id="progress-fill" class="absolute h-0.5 bg-[#0d6efd] top-[12px] left-0 w-[33%] transition-all duration-300 ease-in-out"></div>


        <!-- Step 1: Active state -->
        <!-- Adjusted padding and font size for mobile -->
        <div id="step-1-header" class="flex flex-col items-center relative z-10 px-0.5 sm:px-2">
          <div
            class="flex items-center justify-center w-6 h-6 rounded-full bg-[#0d6efd] text-white text-xs font-semibold border-2 border-[#0d6efd]"
          >
            1
          </div>
          <span class="text-[#0d6efd] font-semibold text-[9px] sm:text-sm mt-1 whitespace-nowrap">Informaci√≥n del cliente</span>
        </div>

        <!-- Step 2: Inactive state -->
        <!-- Adjusted padding and font size for mobile -->
        <div id="step-2-header" class="flex flex-col items-center relative z-10 px-0.5 sm:px-2">
          <div
            class="flex items-center justify-center w-6 h-6 rounded-full border border-gray-300 bg-white text-xs text-gray-400"
          >
            2
          </div>
          <span class="text-gray-600 text-[9px] sm:text-sm mt-1 whitespace-nowrap">Informaci√≥n de pago</span>
        </div>

        <!-- Step 3: Inactive state with checkmark -->
        <!-- Adjusted padding and font size for mobile -->
        <div id="step-3-header" class="flex flex-col items-center relative z-10 px-0.5 sm:px-2">
          <div
            class="flex items-center justify-center w-6 h-6 rounded-full border border-gray-300 bg-white text-xs text-gray-400"
          >
            <i class="fas fa-check"></i>
          </div>
          <span class="text-gray-600 text-[9px] sm:text-sm mt-1 whitespace-nowrap">¬°Reserva confirmada!</span>
        </div>
      </nav>
    </div>
  </header>

  <!-- Timer bar - Added ID for JavaScript functionality -->
  <div
    class="bg-[#fff0eb] border border-[#fcd9cc] text-[#b33a3a] text-sm font-semibold flex items-center justify-center space-x-2 py-1"
  >
    <i class="far fa-clock"></i>
    <span>Estamos manteniendo tu precio...</span>
    <span id="timer-display" class="font-mono tracking-wide">00:19:54</span>
  </div>

  <main
    id="main-content"
    class="max-w-[1200px] mx-auto px-6 py-8 flex flex-col lg:flex-row gap-6 min-h-[calc(100vh-140px)]"
  >
    <!-- Summary section (appears first on mobile, second on desktop) -->
    <aside class="w-full lg:w-[360px] flex flex-col order-first lg:order-last">
      <!-- Date section as a separate block - Adjusted for mobile responsiveness -->
      <div
        id="date-display-block"
        class="bg-white border border-gray-300 rounded-xl p-4 mb-5 text-gray-600 cursor-pointer grid grid-cols-[1fr_auto_1fr_auto] items-center gap-x-2"
      >
        <!-- Row 1: Headers -->
        <div class="header-cell">Registrarse</div>
        <div></div> <!-- Spacer for arrow column -->
        <div class="header-cell">Verificar</div>
        <div class="header-cell text-right"></div> <!-- Placeholder for nights header -->

        <!-- Row 2: Dates and Nights -->
        <div class="flex flex-col items-start">
          <div id="display-checkin-date" class="font-semibold text-base text-[#222222]">Vie, 11 de julio</div>
          <div id="display-checkin-time" class="text-xs font-normal text-gray-600">14:00</div>
        </div>

        <div class="text-xl text-gray-600 flex-shrink-0">‚Üí</div>
        
        <div class="flex flex-col items-start">
          <div id="display-checkout-date" class="font-semibold text-base text-[#222222]">S√°bado 19 de julio</div>
          <div id="display-checkout-time" class="text-xs font-normal text-gray-600">13:00</div>
        </div>
        
        <div class="flex flex-col items-end">
          <div id="display-nights" class="font-bold text-2xl text-[#222222]">8</div>
          <div class="text-xs font-normal text-gray-600">nights</div>
        </div>
      </div>

      <!-- Combined Hotel, Apartment, Features, and Cancellation Policy Section -->
      <div class="bg-white border border-gray-300 rounded-xl p-5 shadow-sm mb-6">
        <!-- Hotel Details -->
        <div class="flex gap-3 mb-4 pb-4 border-b border-gray-300">
          <img
            alt="Collage de fotos del interior del apartamento con cama, estanter√≠a y escritorio"
            class="w-20 h-20 rounded-md object-cover flex-shrink-0"
            height="80"
            src="https://storage.googleapis.com/a1aa/image/bd0ca2eb-5c60-48b0-7b47-cd427e61bf46.jpg"
            width="80"
          />
          <div class="flex-1 text-sm">
            <h3 class="font-semibold text-[#222222] mb-1">Lomas de las Mercedes</h3>
            <div class="flex items-center text-gray-500 text-xs mb-1 space-x-1">
              <i class="fas fa-circle-notch fa-spin text-green-600 text-[10px]"></i>
              <span>Apartamento/Piso</span>
            </div>
            <div class="flex items-center mb-1 text-pink-600 space-x-1">
              <i class="fas fa-star text-sm"></i>
              <i class="fas fa-star text-sm"></i>
              <i class="fas fa-star text-sm"></i>
              <i class="fas fa-star text-sm"></i>
            </div>
            <div class="text-[#0d6efd] font-semibold text-sm mb-1">
              9.7 Excepcional
              <span class="text-gray-400 font-normal ml-1 text-xs">49 rese√±as</span>
            </div>
            <div class="text-xs text-gray-500 mb-1 truncate max-w-[220px]">
              San Agust√≠n Del Norte, Caracas, Capital Venezolana, Venezuela
            </div>
            <a
              href="#"
              class="text-[#0d6efd] text-xs font-semibold hover:underline mt-0.5 inline-block"
              >¬øQu√© hay cerca?</a
            >
          </div>
        </div>

        <!-- Apartment details box (nested with its own border) -->
        <div class="bg-blue-50 rounded-md p-4 text-gray-700 text-sm space-y-2 border border-gray-300 mb-4">
          <div class="flex space-x-3 items-center font-semibold text-gray-900 pb-3">
            <img
              alt="Interior del apartamento con cama, estanter√≠a y escritorio"
              class="w-10 h-10 rounded-md object-cover flex-shrink-0"
              height="40"
              src="https://storage.googleapis.com/a1aa/image/a25bb66f-5ad8-4226-be1a-0afa0be991c9.jpg"
              width="40"
            />
            <div>
              1 x Apartamento
            </div>
          </div>
          <!-- Removed all internal borders for a cleaner look -->
          <div class="py-1">
            Superficie: 50 m¬≤
          </div>
          <div class="py-1">
            M√°x: 1 adulto, 1 ni√±o (0-17 a√±os)
          </div>
          <div class="py-1 mb-2">
            1 cama doble
          </div>
          <div class="flex items-center space-x-1 text-gray-500 text-xs py-1">
            <i class="fas fa-door-open"></i>
            <span>√öltimo check-in antes de las 20:30</span>
          </div>
          <div class="flex items-center space-x-1 text-gray-400 text-xs py-1">
            <i class="fas fa-check"></i>
            <span>Pagar en el hotel</span>
          </div>
          <div class="text-orange-600 text-xs font-semibold py-1 mt-2">
            <i class="fas fa-exclamation-triangle"></i>
            <span>¬°Date prisa! ¬°Tenemos la √∫ltima habitaci√≥n disponible para tus fechas a este precio!</span>
          </div>
          <ul class="list-none space-y-1 text-green-700 text-xs font-semibold pt-2">
            <li class="flex items-center space-x-1">
              <i class="fas fa-check"></i>
              <span>Aparcamiento</span>
            </li>
            <li class="flex items-center space-x-1">
              <i class="fas fa-check"></i>
              <span>Caf√© y t√©</span>
            </li>
            <li class="flex items-center space-x-1">
              <i class="fas fa-check"></i>
              <span>Check-in expr√©s</span>
            </li>
            <li class="flex items-center space-x-1">
              <i class="fas fa-check"></i>
              <span>Wifi gratis</span>
            </li>
            <li class="flex items-center space-x-1">
              <i class="fas fa-check"></i>
              <span>Agua potable</span>
            </li>
          </ul>
          <div class="grid grid-cols-2 gap-3 mt-3">
            <span class="flex items-center justify-center gap-1 border border-green-700 text-green-700 rounded px-3 py-1 text-xs font-semibold hover:bg-green-50 transition">
              <i class="fas fa-desktop"></i> Escritorio
            </span>
            <span class="flex items-center justify-center gap-1 border border-green-700 text-green-700 rounded px-3 py-1 text-xs font-semibold hover:bg-green-50 transition">
              <i class="fas fa-bottle-water"></i> Agua embotellada gratis
            </span>
            <span class="flex items-center justify-center gap-1 border border-green-700 text-green-700 rounded px-3 py-1 text-xs font-semibold hover:bg-green-50 transition">
              <i class="fas fa-parking"></i> Aparcamiento
            </span>
            <span class="flex items-center justify-center gap-1 border border-green-700 text-green-700 rounded px-3 py-1 text-xs font-semibold hover:bg-green-50 transition">
              <i class="fas fa-wifi"></i> Wi-Fi gratis
            </span>
          </div>
        </div>

        <!-- Cancellation Policy Button -->
        <button
          type="button"
          class="w-full flex justify-between items-center text-sm font-semibold text-green-700 border border-gray-300 rounded px-4 py-2 hover:bg-green-50 transition"
        >
          <div class="flex items-center gap-3">
            <i class="fas fa-shield-alt text-lg"></i>
            <span>Pol√≠tica de cancelaci√≥n</span>
          </div>
          <i class="fas fa-chevron-right text-lg"></i>
        </button>
      </div>

      <!-- Price and Payment Section (moved up to match screenshot order) -->
      <div class="bg-white rounded-xl border border-gray-200 text-sm mb-6">
        <!-- Discount Banner -->
        <div class="bg-red-500 text-white text-center py-1 rounded-t-xl text-xs font-semibold">
            21% DE DESCUENTO HOY
        </div>

        <div class="p-4">
          <!-- Room Price and Booking Fees -->
          <div class="flex justify-between mb-1">
              <span class="font-medium">Precio original ( 8 noches )</span>
              <span class="font-semibold">669,77 ‚Ç¨</span>
          </div>
          <div class="flex justify-between mb-1">
              <span class="font-medium">Precio de la habitaci√≥n ( 8 noches )</span>
              <span class="font-semibold">503,76 ‚Ç¨</span>
          </div>
          
          <!-- Final Price Header -->
          <div class="flex justify-between items-center border-t border-gray-200 pt-3 mt-3">
              <span class="font-semibold text-base">Precio final <i class="fas fa-info-circle text-xs ml-1"></i></span>
              <span class="font-bold text-base">507,56 ‚Ç¨</span>
          </div>

          <p class="text-[10px] text-gray-400 mb-3">
            Incluido en el precio total: Tasa de limpieza 17,07 ‚Ç¨, IVA 52,56 ‚Ç¨
          </p>

          <!-- Pay to the Property Section -->
          <div class="border-t border-gray-200 pt-4 mt-4">
              <div class="flex justify-between mb-1">
                <span class="font-semibold text-base">Pagar en la Propiedad</span>
                <span class="font-bold text-base">507,56 ‚Ç¨</span>
              </div>
              <p class="text-xs text-gray-500 mb-3">
                Pagar√°s el Apartamento cerca del Boulevard de Sabana Grande y zona comercial
                en la moneda de la propiedad (los tipos de cambio pueden variar): USD 594,52 =
                ‚Ç¨ 507,56
              </p>
          </div>

          <!-- Price Match Guarantee -->
          <div
            class="bg-[#0b5e07] bg-opacity-10 rounded-xl p-3 text-xs text-[#0b5e07] font-semibold mt-4"
          >
            Igualamos los precios. ¬°Si lo encuentras por menos, lo igualamos!
            <i class="fas fa-info-circle text-xs"></i>
          </div>

          <p class="text-[10px] text-gray-400 mt-2">¬°Sab√≠a elecci√≥n! Has ahorrado 18,07 USD.</p>
        </div>
      </div>

      <!-- Separated green boxes -->
      <div class="bg-[#d9f0d9] rounded-xl p-4 text-sm text-[#0b5e07] flex items-center gap-2 font-semibold mb-6">
        <i class="fas fa-thumbs-up text-base"></i>
        <span>
          ¬°Excelente elecci√≥n!
          <span class="font-normal"
            >Has elegido nuestra tarifa m√°s baja en Lomas de las Mercedes.</span
          >
        </span>
      </div>
      <div class="bg-[#d9f0d9] rounded-xl p-4 text-sm text-[#0b5e07] flex items-center gap-2 font-semibold mb-6">
        <i class="fas fa-thumbs-up text-base"></i>
        <span>
          Gran variedad de propiedades,
          <span class="font-normal">con una calificaci√≥n promedio de los hu√©spedes de</span>
          <span class="font-semibold text-[#0d6efd]">9,7</span>
        </span>
      </div>

      <!-- Red and Orange boxes -->
      <div class="bg-[#fddede] rounded-xl p-4 text-sm text-[#b33a3a] space-y-2 mb-6">
        <p class="flex items-center gap-2 font-semibold">
          <i class="fas fa-clock text-base"></i> ¬°Date prisa! ¬°Tenemos la √∫ltima habitaci√≥n disponible para tus fechas a este precio!
        </p>
      </div >

      <div class="bg-[#ffe3d3] rounded-xl p-4 text-sm text-[#b35a0b] space-y-2 mb-6">
        <p class="flex items-center gap-2 font-semibold">
          <i class="fas fa-clock text-base"></i>
          Faltan solo <span class="font-bold">2 d√≠as</span> para tu llegada.
          <span class="font-bold">Las tarifas podr√≠an aumentar si no reservas ahora.</span>
        </p>
      </div>

      <!-- About Payment Section -->
      <div class="bg-white rounded-xl border border-gray-200 p-4 text-sm">
        <h3 class="font-semibold text-base mb-2">Sobre el pago</h3>
        <p class="text-xs text-gray-500">
          El pago de esta reserva ser√° cobrado por la propiedad, no por Guacamayafly. Compartiremos los detalles de tu tarjeta de cr√©dito con nuestro proveedor y con la propiedad para asegurar tu reserva y completar la transacci√≥n.
          <a href="#" class="text-[#0d6efd] font-semibold hover:underline">Ver condiciones de reserva.</a>
        </p>
      </div>
    </aside>

    <section
      class="flex-1 bg-white rounded-xl border border-gray-200 p-6 max-w-full order-last lg:order-first"
    >
      <!-- Guacamayafly Cash Block -->
      <div class="bg-blue-100 border border-blue-200 text-blue-800 text-sm p-4 rounded-xl mb-6">
          <p class="font-semibold mb-2">
              ¬°Inicia sesi√≥n para utilizar tu Guacamayafly Cash!
              <a href="#" class="text-blue-600 hover:underline font-bold">Iniciar sesi√≥n</a>
          </p>
          <p class="text-xs text-blue-700">
              Iniciar sesi√≥n en su cuenta de Guacamayafly le permitir√° realizar
              reservas m√°s r√°pidas y obtener m√°s recompensas.
          </p>
      </div>

      <form id="booking-form">
        <!-- Step 1: Guest Information and Special Requests -->
        <div id="step-1">
          <h2 class="text-base font-semibold mb-2">
            ¬øQui√©n es el invitado principal?
          </h2>
          <p class="text-sm text-[#b33a3a] mb-4 font-semibold">
            *Campo obligatorio
          </p>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
              <label
                class="block text-sm font-semibold text-gray-600 mb-1"
                for="nombre"
                >Nombre de pila *</label
              >
              <input
                class="w-full border border-gray-300 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-1 focus:ring-[#0d6efd]"
                id="nombre"
                name="nombre"
                type="text"
                required
              />
            </div>
            <div>
              <label
                class="block text-sm font-semibold text-gray-600 mb-1"
                for="apellido"
                >Apellido *</label
              >
              <input
                class="w-full border border-gray-300 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-1 focus:ring-[#0d6efd]"
                id="apellido"
                name="apellido"
                type="text"
                required
              />
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
              <label
                class="block text-sm font-semibold text-gray-600 mb-1"
                for="email"
                >Correo electr√≥nico *</label
              >
              <input
                class="w-full border border-gray-300 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-1 focus:ring-[#0d6efd]"
                id="email"
                name="email"
                type="email"
                required
              />
            </div>
            <div>
              <label
                class="block text-sm font-semibold text-gray-600 mb-1"
                for="pais"
                >Pa√≠s/regi√≥n de residencia *</label
              >
              <select
                class="w-full border-2 border-green-500 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-1 focus:ring-[#0d6efd]"
                id="pais"
                name="pais"
                required
              >
                <option value="">Selecciona un pa√≠s</option>
                <option>Pa√≠ses Bajos</option>
                <option>Espa√±a</option>
                <option>Venezuela</option>
                <option>Colombia</option>
                </select>
            </div>
          </div>
          <div class="mb-6">
            <label
              class="block text-sm font-semibold text-gray-600 mb-1"
              for="telefono"
              >N√∫mero de tel√©fono (opcional)</label
              >
            <input
              class="w-full border border-gray-300 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-1 focus:ring-[#0d6efd]"
              id="telefono"
              name="telefono"
              type="tel"
            />
          </div>

          <fieldset
            class="border border-gray-300 rounded-xl p-4 mb-6 text-sm"
            aria-label="Solicitudes especiales"
          >
            <legend class="font-semibold text-base mb-2">Solicitudes especiales</legend>
            <p class="text-gray-500 mb-4 text-sm">
              Selecciona tu(s) preferencia(s) (sujeto a disponibilidad).
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <p class="font-semibold mb-2 text-sm">
                  ¬øQu√© tipo de habitaci√≥n preferir√≠as?
                </p>
                <div class="flex items-center mb-2">
                  <input
                    class="mr-2 w-5 h-5"
                    id="no-fumadores"
                    name="fumadores"
                    type="radio"
                  />
                  <label
                    class="flex items-center gap-1 text-sm"
                    for="no-fumadores"
                    ><i class="fas fa-smoking-ban text-lg"></i> Habitaci√≥n de no fumadores</label
                  >
                </div>
                <div class="flex items-center">
                  <input class="mr-2 w-5 h-5" id="fumadores" name="fumadores" type="radio" />
                  <label class="flex items-center gap-1 text-sm" for="fumadores"
                    ><i class="fas fa-smoking text-lg"></i> Habitaci√≥n de fumadores</label
                  >
                </div>
              </div>
              <div>
                <p class="font-semibold mb-2 text-sm">
                  ¬øQu√© configuraci√≥n de camas prefieres?
                </p>
                <div class="flex items-center mb-2">
                  <input class="mr-2 w-5 h-5" id="cama-grande" name="camas" type="radio" />
                  <label class="flex items-center gap-1 text-sm" for="cama-grande"
                    ><i class="fas fa-bed text-lg"></i> Quiero una cama grande</label
                  >
                </div>
                <div class="flex items-center">
                  <input class="mr-2 w-5 h-5" id="camas-separadas" name="camas" type="radio" />
                  <label class="flex items-center gap-1 text-sm" for="camas-separadas"
                    ><i class="fas fa-bed text-lg"></i> Quiero camas separadas</label
                  >
                </div>
              </div>
            </div>
            <button
              type="button"
              class="mt-3 text-sm text-[#0d6efd] font-semibold underline flex items-center gap-1"
            >
              Haz clic aqu√≠ para m√°s solicitudes.
              <i class="fas fa-chevron-down text-sm"></i>
            </button>
          </fieldset>

          <p class="text-sm text-[#b33a3a] font-semibold mb-3">
            ¬°Date prisa! ¬°Tenemos la √∫ltima habitaci√≥n disponible para tus fechas a este precio!
          </p>
        </div>

        <div id="hospitality-info" class="bg-white rounded-xl border border-gray-200 p-6 mb-6">
            <h2 class="text-base font-semibold mb-2">
                Informaci√≥n adicional sobre hospitalidad
            </h2>
            <p class="text-gray-500 mb-4 text-sm">
                Por favor proporcione la siguiente informaci√≥n para
                optimizar los servicios que brinda la propiedad
            </p>
            <p class="font-semibold mb-2 text-sm">Av√≠sanos cuando llegues</p>
            <p class="text-gray-500 mb-4 text-sm">
                Le informaremos a la propiedad o al anfitri√≥n cu√°ndo
                esperarlo.
            </p>
            <select class="w-full border border-gray-300 rounded-xl px-4 py-3 text-base focus:outline-none focus:ring-1 focus:ring-[#0d6efd]">
                <option>Seleccionar</option>
                <option>No s√©</option>
            </select>
        </div>

        <div class="bg-white rounded-xl border border-gray-200 p-6 mb-6">
            <div class="flex items-center mb-4">
                <input type="checkbox" id="guacamayafly-updates" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500">
                <label for="guacamayafly-updates" class="ml-2 text-sm text-gray-700">
                    Acepto recibir actualizaciones y promociones de Guacamayafly y sus afiliados o socios comerciales a trav√©s de diversos canales, incluido WhatsApp. Puede cancelar su suscripci√≥n en cualquier momento.
                    <a href="#" class="text-[#0d6efd] hover:underline">Lea m√°s en la Pol√≠tica de Privacidad.</a>
                </label>
            </div>
            <div class="bg-green-100 border border-green-200 text-green-800 text-sm p-4 rounded-xl flex items-center gap-2 font-semibold">
                <i class="fas fa-check-circle text-base"></i>
                <span>
                    ¬°No necesitas tarjeta de cr√©dito para reservar!
                    <span class="font-normal">
                        Puedes reservar ahora sin proporcionar detalles de pago y pagar en el establecimiento durante tu estancia.
                    </span>
                </span>
            </div>
        </div>

        <div class="bg-white rounded-xl border border-gray-200 p-6 mb-6">
            <p class="text-sm text-gray-600 mb-3">
                Al continuar con esta reserva, acepto los t√©rminos y
                condiciones de Guacamayafly. <a href="#" class="text-[#0d6efd] font-semibold hover:underline">Condiciones de uso</a> y
                <a href="#" class="text-[#0d6efd] font-semibold hover:underline">pol√≠tica de privacidad</a>.
            </p>
            <p class="text-orange-600 text-xs font-semibold py-1 mt-2">
                <i class="fas fa-exclamation-triangle"></i>
                <span>¬°Date prisa! ¬°Tenemos la √∫ltima habitaci√≥n disponible para tus fechas a este precio!</span>
            </p>
            <div class="flex items-center gap-2 text-gray-500 text-sm mt-4">
                <i class="fas fa-envelope text-lg"></i>
                <span>Le enviaremos la confirmaci√≥n de su reserva a la direcci√≥n de correo electr√≥nico proporcionada.</span>
            </div>
        </div>

        <div id="step-2-payment-info">
            <h2 class="text-base font-semibold mb-2">
                Informaci√≥n de pago
            </h2>
            <p class="text-sm text-gray-600 mb-4">
                Por favor, selecciona tu m√©todo de pago preferido.
            </p>

            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">M√©todo de Pago</label>
                <div class="space-y-3" id="payment-options-container">
                    <div class="payment-option" data-payment="whatsapp">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold text-sm">Reservar por WhatsApp</span>
                            <i class="fab fa-whatsapp text-xl text-green-500"></i>
                        </div>
                    </div>
                    <div class="payment-option" data-payment="card">
                        <div class="flex items-center justify-between">
                            <span class="font-semibold text-sm">Tarjeta de Cr√©dito/D√©bito</span>
                            <div class="flex items-center gap-2">
                                <img src="https://cryptoindex.com/pic/icons/visa-mastercard.svg" alt="Visa y Mastercard" class="payment-logo">
                            </div>
                        </div>
                    </div>
                    <div class="payment-option" data-payment="crypto">
                         <div class="flex items-center justify-between">
                            <span class="font-semibold text-sm">Pagar con Criptomonedas</span>
                            <img src="https://www.bybit.com/bycsi-root/assets/image/coins/light/btc.svg?quality=63&format=avif&resize=width/50.4" alt="Bitcoin" class="payment-logo">
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-between mt-6">
                <button
                    type="button"
                    id="prev-step-btn"
                    class="bg-gray-200 text-gray-700 text-lg font-bold py-3 px-6 rounded-xl hover:bg-gray-300 transition"
                >
                    ANTERIOR
                </button>
            </div>
        </div>
      </form>
    </section>
  </main>

<section id="crypto-checkout-section" class="hidden max-w-4xl mx-auto py-12 px-6">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800">Finalizar Pago con Criptomonedas</h2>
        <button id="close-crypto-checkout-btn" class="text-gray-500 hover:text-gray-800">
            <i class="fas fa-times fa-lg"></i>&nbsp;Volver
        </button>
    </div>
    <div class="bg-gray-50 p-6 rounded-lg shadow-md">
        <div class="flex flex-col md:flex-row gap-8">
            <div class="md:w-2/3">
                <h3 class="font-bold text-gray-700 mb-3 text-lg">Resumen de la Reserva</h3>
                <div id="crypto-summary-details" class="text-sm space-y-2 text-gray-600">
                    <p><strong>Hotel:</strong> Lomas de las Mercedes</p>
                    <p><strong>Check-in:</strong> Vie, 11 de julio</p>
                    <p><strong>Check-out:</strong> S√°bado 19 de julio</p>
                    <p><strong>Noches:</strong> 8</p>
                    <p class="font-bold mt-2 text-lg text-guacamayafly-orange">Monto a Pagar: 507.56 ‚Ç¨</p>
                </div>
            </div>
            <div class="md:w-1/2 flex flex-col items-center">
                <p class="font-semibold text-gray-700 mb-2">Escanear para Pagar</p>
                <div class="p-3 border rounded-lg bg-white shadow-sm">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh" alt="C√≥digo QR de pago" id="crypto-qr-code-img" class="w-40 h-40">
                </div>
                 <p class="text-xs text-gray-500 mt-2">Use su billetera para escanear</p>
            </div>
        </div>
        <div class="mt-6 border-t pt-6">
            <h3 class="font-bold text-gray-700 mb-3 text-lg">O Pagar a la Siguiente Direcci√≥n</h3>
            <div id="crypto-wallets-list" class="space-y-3">
                </div>
            <div class="mt-4">
              <label class="block text-sm font-semibold text-gray-600 mb-1" for="comprobante-pago">Cargar Comprobante de Pago (opcional)</label>
              <input type="file" id="comprobante-pago" class="w-full text-sm text-gray-500
                file:mr-4 file:py-2 file:px-4
                file:rounded-full file:border-0
                file:text-sm file:font-semibold
                file:bg-blue-50 file:text-blue-700
                hover:file:bg-blue-100"/>
            </div>
            <button id="payment-received-btn" class="w-full bg-guacamayafly-green text-white text-lg font-bold py-3 rounded-xl hover:bg-guacamayafly-dark-green transition mt-6">
                He pagado
            </button>
            <p id="payment-validation-message" class="text-center text-sm text-gray-600 mt-2 hidden">Validando pago... <span id="countdown-timer"></span></p>
        </div>
    </div>
</section>


<section id="reservation-confirmed-section" class="hidden max-w-2xl mx-auto py-12 px-6 text-center bg-white rounded-xl shadow-lg mt-8">
    <div class="text-green-500 mb-4">
        <i class="fas fa-check-circle fa-5x"></i>
    </div>
    <h2 class="text-3xl font-bold text-gray-800 mb-2">¬°Reserva Confirmada!</h2>
    <p class="text-lg text-gray-600 mb-4">Tu reserva ha sido procesada con √©xito.</p>
    <p class="text-xl font-bold text-guacamayafly-orange mb-2">N√∫mero de Reserva: <span id="booking-number"></span></p>
    <p class="text-base text-gray-700 mb-4">ID de Confirmaci√≥n: <span id="confirmation-id"></span></p>
    <p class="text-sm text-gray-500">Recibir√°s un correo electr√≥nico de confirmaci√≥n con todos los detalles de tu reserva en breve.</p>
    <p class="text-sm text-gray-500 mt-4">Redirigiendo al inicio en <span class="font-bold">6</span> segundos...</p>
    <button onclick="window.location.href = 'index.html';" class="mt-6 bg-[#0d6efd] text-white text-lg font-bold py-3 px-6 rounded-xl hover:bg-[#0b5ed7] transition">
        Volver al Inicio
    </button>
</section>


<div id="calendar-modal" class="modal-overlay hidden calendar-modal">
    <div class="modal-container">
        <div class="calendar-modal-header">
             <h3 class="font-semibold text-lg">Selecciona fechas</h3>
             <button id="close-calendar-modal-x" class="p-2 rounded-full hover:bg-gray-200 text-2xl leading-none">&times;</button>
        </div>
        <div class="calendar-modal-top-info">
            <div class="info-box">
                <span class="label">Check-in</span>
                <span id="calendar-checkin-display" class="value">--</span>
            </div>
            <div class="info-box">
                <span class="label">Check-out</span>
                <span id="calendar-checkout-display" class="value">--</span>
            </div>
        </div>
        <div class="calendar-modal-body">
            <div class="flex items-center gap-2 text-sm text-gray-700 mb-4">
                <i class="far fa-calendar-alt"></i>
                <p>Selecciona fechas para encontrar los mejores precios para tu viaje</p>
            </div>
            <div class="calendar-header">
                <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200"><i class="fas fa-chevron-left"></i></button>
                <h4 id="calendar-month-year" class="font-semibold text-lg"></h4>
                <button id="next-month" class="p-2 rounded-full hover:bg-gray-200"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="calendar-months" id="calendar-months-container"></div>
            <div class="price-legend">
                <div><div class="color-box" style="background-color: #d1fae5;"></div><span>M√°s barato</span></div>
                <div><div class="color-box" style="background-color: #fee2e2;"></div><span>M√°s caro</span></div>
            </div>
            <p class="text-center text-xs text-gray-500 mt-2">Seg√∫n los precios promedio</p>
             <div class="quick-select-buttons">
                <button id="tonight-btn">Esta noche</button>
                <button id="next-weekend-btn">El pr√≥ximo fin de semana</button>
            </div>
        </div>
        <div class="calendar-modal-footer">
            <button id="clear-dates-btn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 font-semibold">Limpiar</button>
            <button id="close-calendar-btn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-semibold">Aplicar</button>
        </div>
    </div>
</div>


<footer class="bg-gray-100 mt-12 py-10 text-xs text-blue-900">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-5xl mx-auto grid grid-cols-1 sm:grid-cols-4 gap-y-6 gap-x-8">
            <div>
                <div class="mb-3 font-semibold">Empresa</div>
                <ul class="space-y-1">
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Qui√©nes somos</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Empleo</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Anuncia tu alojamiento</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Publicidad</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Prensa</a></li>
                </ul>
            </div>
            <div>
                <div class="mb-3 font-semibold">B√∫squedas</div>
                <ul class="space-y-1">
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Viajes a Espa√±a</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Hoteles en Espa√±a</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Alquileres vacacionales Espa√±a</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Paquetes de vacaciones baratos</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Vuelos baratos en Espa√±a</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Alquiler de coches en Espa√±a</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Todos los alojamientos</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Guacamayafly Explore</a></li>
                </ul>
            </div>
            <div>
                <div class="mb-3 font-semibold">Pol√≠ticas</div>
                <ul class="space-y-1">
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">T√©rminos y condiciones generales (excepto para reservas de Vrbo)</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">T√©rminos y condiciones de Vrbo</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Privacidad</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Cookies</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Condiciones de uso</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Informaci√≥n legal/contacto</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Pautas sobre el contenido y c√≥mo denunciar contenido</a></li>
                </ul>
            </div>
            <div>
                <div class="mb-3 font-semibold">Ayuda</div>
                <ul class="space-y-1">
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Ayuda</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Cancelar un vuelo</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Cancelar una reserva de hotel o de un alquiler vacacional</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Plazos de reembolso</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Utilizar un cup√≥n de Guacamayafly</a></li>
                    <li><a class="hover:underline" href="https://wa.me/5804243156057">Documentos para viajes internacionales</a></li>
                </ul>
            </div>
        </div>
        <div class="mt-8 text-center text-[9px] text-gray-600">
            El sitio web de Guacamayafly.es permite pagar con American Express, Diner's Club International, MasterCard, Visa, Visa Electron, CartSsi, Carte Bleue y PayPal.
        </div>
    </div>
</footer>

<button aria-label="Ayuda" class="fixed bottom-4 right-4 bg-white border border-gray-300 rounded-full px-3 py-1 text-xs text-gray-700 shadow-md hover:bg-gray-50 flex items-center space-x-1" onclick="window.location.href='https://wa.me/5804243156057'">
    <span>Ayuda</span>
    <i class="fas fa-question-circle"></i>
</button>

<div id="sticky-reserve-btn-container">
    <button id="sticky-reserve-btn">
        <i class="fas fa-lock"></i>
        <span>¬°RESERVA YA!</span>
    </button>
    <p id="sticky-reserve-info">
        No se necesita tarjeta de cr√©dito ni pago para reservar.
    </p>
</div>

<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'guacamayafly-green': '#00c897',
                    'guacamayafly-dark-green': '#00b386',
                    'guacamayafly-orange': '#FF7F00',
                    'guacamayafly-dark-orange': '#E67300',
                }
            }
        }
    }
    document.addEventListener('DOMContentLoaded', function() {
        // --- Pop-up de Sitio en Desarrollo ---
        const devPopupOverlay = document.getElementById('development-popup-overlay');
        const devPopupCloseBtn = document.getElementById('development-popup-close');
        let onPopupConfirmCallback = null;

        function showDevelopmentPopup(callback) {
            onPopupConfirmCallback = callback;
            if (devPopupOverlay) {
                devPopupOverlay.classList.remove('hidden');
                setTimeout(() => devPopupOverlay.classList.add('visible'), 10);
            }
        }

        if (devPopupCloseBtn) {
            devPopupCloseBtn.addEventListener('click', () => {
                if (devPopupOverlay) {
                    devPopupOverlay.classList.remove('visible');
                    devPopupOverlay.addEventListener('transitionend', () => {
                        devPopupOverlay.classList.add('hidden');
                    }, { once: true });
                }
                if (typeof onPopupConfirmCallback === 'function') {
                    onPopupConfirmCallback();
                    onPopupConfirmCallback = null;
                }
            });
        }
        
        // Mostrar pop-up en la primera visita a esta p√°gina
        if (!sessionStorage.getItem('checkoutPopupShown')) { // Changed key to be specific to checkout page
            showDevelopmentPopup(() => {
                sessionStorage.setItem('checkoutPopupShown', 'true');
            });
        }


        const form = document.getElementById('booking-form');
        const mainContent = document.getElementById('main-content');
        const step1 = document.getElementById('step-1'); // Corrected ID reference
        const step2 = document.getElementById('step-2-payment-info'); // Corrected ID reference
        const nextStepBtn = document.getElementById('next-step-btn'); // This button is now removed from HTML, but reference kept for logic
        const prevStepBtn = document.getElementById('prev-step-btn');
        const payBtn = document.getElementById('pay-btn'); // This button is now removed from HTML, but reference kept for logic
        const progressFill = document.getElementById('progress-fill');
        const step1Header = document.getElementById('step-1-header');
        const step2Header = document.getElementById('step-2-header');
        const step3Header = document.getElementById('step-3-header');

        const cryptoCheckoutSection = document.getElementById('crypto-checkout-section');
        const closeCryptoCheckoutBtn = document.getElementById('close-crypto-checkout-btn');
        const paymentReceivedBtn = document.getElementById('payment-received-btn');
        const paymentValidationMessage = document.getElementById('payment-validation-message');
        const countdownTimerDisplay = document.getElementById('countdown-timer');
        const reservationConfirmedSection = document.getElementById('reservation-confirmed-section');
        const bookingNumberElement = document.getElementById('booking-number');
        const confirmationIdElement = document.getElementById('confirmation-id');
        const redirectCountdownElement = document.getElementById('redirect-countdown');

        const stickyReserveBtnContainer = document.getElementById('sticky-reserve-btn-container');
        const stickyReserveBtn = document.getElementById('sticky-reserve-btn');


        const dateDisplayBlock = document.getElementById('date-display-block');
        const calendarModal = document.getElementById('calendar-modal');
        const calendarMonthsContainer = document.getElementById('calendar-months-container');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const closeCalendarBtn = document.getElementById('close-calendar-btn');
        const clearDatesBtn = document.getElementById('clear-dates-btn');
        const closeCalendarModalX = document.getElementById('close-calendar-modal-x');
        const calendarCheckinDisplay = document.getElementById('calendar-checkin-display');
        const calendarCheckoutDisplay = document.getElementById('calendar-checkout-display');
        const calendarMonthYear = document.getElementById('calendar-month-year');
        const tonightBtn = document.getElementById('tonight-btn');
        const nextWeekendBtn = document.getElementById('next-weekend-btn');

        const displayCheckinDate = document.getElementById('display-checkin-date');
        const displayCheckoutDate = document.getElementById('display-checkout-date');
        const displayNights = document.getElementById('display-nights');

        // Timer variables
        let timerInterval;
        const initialTimeInSeconds = 20 * 60; // 20 minutes
        let timeLeft = initialTimeInSeconds;

        // Auth status elements
        const authStatusContainer = document.getElementById('auth-status-container');
        // Use event delegation for dynamically added login/logout buttons
        authStatusContainer.addEventListener('click', (event) => {
            if (event.target.id === 'login-btn') {
                localStorage.setItem('isLoggedIn', 'true');
                location.reload(); // Reload to reflect login state
            } else if (event.target.id === 'logout-btn') {
                localStorage.setItem('isLoggedIn', 'false');
                location.reload(); // Reload to reflect logout state
            }
        });
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true'; // Simulate login state

        // Function to render auth status (login button or avatar)
        function renderAuthStatus() {
            authStatusContainer.innerHTML = ''; // Clear previous content
            if (isLoggedIn) {
                // Display avatar and logout button
                authStatusContainer.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <img src="https://placehold.co/32x32/FF7F00/FFFFFF?text=AV" alt="User Avatar" class="rounded-full w-8 h-8 cursor-pointer" id="avatar-btn">
                        <button id="logout-btn" class="hidden sm:block text-[#0d6efd] border border-[#0d6efd] rounded-xl px-2 py-1 text-[10px] sm:text-sm font-semibold hover:bg-[#0d6efd] hover:text-white transition">
                            Cerrar sesi√≥n
                        </button>
                    </div>
                `;
            } else {
                // Display login button
                authStatusContainer.innerHTML = `
                    <button id="login-btn" class="text-[#0d6efd] border border-[#0d6efd] rounded-xl px-2 py-1 text-[10px] sm:text-sm font-semibold hover:bg-[#0d6efd] hover:text-white transition">
                        Iniciar sesi√≥n
                    </button>
                `;
            }
        }

        let currentStep = 1;
        let selectedDeparture = null;
        let selectedReturn = null;
        let currentMonthDate = new Date(); // For calendar

        // --- Utility Functions ---
        function showNotification(message, type = 'success') {
            let container = document.getElementById('notification-container');
            if (!container) {
                console.warn('Notification container not found. Creating one.');
                const body = document.querySelector('body');
                const newContainer = document.createElement('div');
                newContainer.id = 'notification-container';
                body.appendChild(newContainer);
                container = newContainer;
            }
            const popup = document.createElement('div');
            popup.className = `notification-popup ${type === 'error' ? 'bg-red-500' : 'bg-green-500'}`;
            popup.textContent = message;
            container.appendChild(popup);
            requestAnimationFrame(() => popup.classList.add('show'));
            setTimeout(() => {
                popup.classList.remove('show');
                popup.addEventListener('transitionend', () => popup.remove());
            }, 3000);
        }

        // --- Timer Functionality ---
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(remainingSeconds).padStart(2, '0')}`;
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval); // Clear any existing timer
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    document.getElementById('timer-display').textContent = formatTime(timeLeft);
                } else {
                    clearInterval(timerInterval);
                    document.getElementById('timer-display').textContent = '00:00';
                    // Optional: Add logic for when timer runs out, e.g., show a message
                    showNotification('¬°Tu precio ha caducado! Por favor, actualiza la p√°gina.', 'error');
                }
            }, 1000);
        }

        // --- Form Paging Logic ---
        function updateStepVisibility() {
            // Ensure main content is visible unless a specific overlay is active
            mainContent.classList.remove('hidden');
            cryptoCheckoutSection.classList.add('hidden');
            reservationConfirmedSection.classList.add('hidden');
            // Form sections are no longer hidden/shown, they are always present for scrolling
            // step1.classList.remove('hidden'); // No longer needed
            // step2.classList.remove('hidden'); // No longer needed
            form.classList.remove('hidden'); // Ensure form is visible by default for steps
            stickyReserveBtnContainer.classList.remove('hidden'); // Show sticky button by default

            if (currentStep === 1) {
                if (step1) step1.style.display = 'block'; // Added null check
                if (step2) step2.style.display = 'none'; // Added null check
                stickyReserveBtn.innerHTML = '<i class="fas fa-lock"></i><span>¬°RESERVA YA!</span>';
                document.getElementById('sticky-reserve-info').textContent = 'No se necesita tarjeta de cr√©dito ni pago para reservar.';
                progressFill.style.width = '16.5%'; // Adjusted for Step 1
                updateHeaderSteps(1);
            } else if (currentStep === 2) {
                if (step1) step1.style.display = 'none'; // Added null check
                if (step2) step2.style.display = 'block'; // Added null check
                stickyReserveBtn.innerHTML = '<i class="fas fa-lock"></i><span>PAGAR AHORA</span>';
                document.getElementById('sticky-reserve-info').textContent = 'No se necesita tarjeta de cr√©dito ni pago para reservar.';
                progressFill.style.width = '50%'; // Adjusted for Step 2
                updateHeaderSteps(2);
            } else if (currentStep === 3) {
                mainContent.classList.add('hidden'); // Hide main content for confirmation screen
                form.classList.add('hidden'); // Hide the form completely
                cryptoCheckoutSection.classList.add('hidden'); // Ensure crypto section is hidden
                reservationConfirmedSection.classList.remove('hidden');
                progressFill.style.width = '100%'; // Full progress
                updateHeaderSteps(3);
                generateAndDisplayBookingInfo(); // Generate and display booking info
                startRedirectCountdown(); // Start redirect countdown
                stickyReserveBtnContainer.classList.add('hidden'); // Hide sticky button on confirmation
            }
        }

        function updateHeaderSteps(activeStep) {
            const headers = [step1Header, step2Header, step3Header];
            headers.forEach((header, index) => {
                const circle = header.querySelector('div');
                const text = header.querySelector('span');
                const stepNum = index + 1;

                if (stepNum === activeStep) {
                    circle.classList.add('bg-[#0d6efd]', 'text-white', 'border-[#0d6efd]');
                    circle.classList.remove('bg-white', 'text-gray-400', 'border-gray-300');
                    text.classList.add('text-[#0d6efd]', 'font-semibold');
                    text.classList.remove('text-gray-600');
                } else {
                    circle.classList.remove('bg-[#0d6efd]', 'text-white', 'border-[#0d6efd]');
                    circle.classList.add('bg-white', 'text-gray-400', 'border-gray-300');
                    text.classList.remove('text-[#0d6efd]', 'font-semibold');
                    text.classList.add('text-gray-600');
                }
            });

            // Special handling for Step 3 checkmark
            if (activeStep >= 3) {
                if (step3Header.querySelector('div')) { // Added null check
                    step3Header.querySelector('div').innerHTML = '<i class="fas fa-check"></i>';
                    step3Header.querySelector('div').classList.add('bg-[#0d6efd]', 'text-white', 'border-[#0d6efd]');
                    step3Header.querySelector('div').classList.remove('bg-white', 'text-gray-400', 'border-gray-300');
                    if (step3Header.querySelector('span')) {
                        step3Header.querySelector('span').classList.add('text-[#0d6efd]', 'font-semibold');
                        step3Header.querySelector('span').classList.remove('text-gray-600');
                    }
                }
            } else {
                if (step3Header.querySelector('div')) { // Added null check
                    step3Header.querySelector('div').innerHTML = '3'; // Revert to number if not confirmed
                }
            }
        }


        function validateStep(step) {
            let isValid = true;
            let inputsToValidate;

            if (step === 1) {
                if (step1) { // Added null check for step1
                    inputsToValidate = step1.querySelectorAll('input[required], select[required]');
                } else {
                    console.error("Step 1 content element not found for validation.");
                    return false;
                }
            } else if (step === 2) {
                if (step2) { // Added null check for step2
                    inputsToValidate = step2.querySelectorAll('input[required], select[required]');
                } else {
                    console.error("Step 2 content element not found for validation.");
                    return false;
                }
            } else {
                return true; // No validation needed for other steps
            }
            
            inputsToValidate.forEach(input => {
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('border-red-500'); // Highlight invalid fields
                } else {
                    input.classList.remove('border-red-500');
                }
            });

            if (!isValid) {
                showNotification('Por favor, completa todos los campos obligatorios.', 'error');
            }
            return isValid;
        }

        // Handle sticky button click
        stickyReserveBtn.addEventListener('click', function() {
            if (currentStep === 1) {
                if (validateStep(1)) {
                    currentStep = 2;
                    updateStepVisibility();
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top for new step
                }
            } else if (currentStep === 2) {
                const selectedPaymentOption = document.querySelector('.payment-option.selected');
                if (!selectedPaymentOption) {
                    showNotification('Por favor, selecciona un m√©todo de pago.', 'error');
                    return;
                }
                const paymentType = selectedPaymentOption.dataset.payment;
                if (paymentType === 'crypto') {
                    openCryptoCheckout();
                } else if (paymentType === 'whatsapp') {
                    showNotification('Redirigiendo a WhatsApp para finalizar la reserva.', 'success');
                    window.open('https://wa.me/5804243156057?text=Hola, quisiera proceder con mi reserva.', '_blank');
                    // For demo purposes, simulate confirmation after a short delay
                    setTimeout(() => {
                        currentStep = 3;
                        updateStepVisibility();
                    }, 2000);
                } else if (paymentType === 'card') {
                    showNotification('Redirigiendo a la pasarela de pago con tarjeta.', 'success');
                    window.open('https://link.mercadopago.cl/guacamayatravels', '_blank');
                    // For demo purposes, simulate confirmation after a short delay
                    setTimeout(() => {
                        currentStep = 3;
                        updateStepVisibility();
                    }, 2000);
                }
            }
        });


        if (prevStepBtn) { // Added null check
            prevStepBtn.addEventListener('click', function() {
                if (currentStep === 2) {
                    currentStep = 1;
                    updateStepVisibility();
                    window.scrollTo({ top: 0, behavior: 'smooth' }); // Scroll to top for new step
                }
            });
        }

        // --- Payment Logic ---
        const paymentOptionsContainer = document.getElementById('payment-options-container');
        if (paymentOptionsContainer) { // Added null check
            paymentOptionsContainer.addEventListener('click', function(event) {
                const selectedOption = event.target.closest('.payment-option');
                if (selectedOption) {
                    document.querySelectorAll('.payment-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    selectedOption.classList.add('selected');

                    // The actual payment action is now triggered by the sticky button
                    // based on the selected option.
                }
            });
        }

        // --- Crypto Checkout Section Logic ---
        const cryptoWallets = [
            { name: 'Bitcoin (BTC)', address: 'bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh', logo: 'https://www.bybit.com/bycsi-root/assets/image/coins/light/btc.svg?quality=63&format=avif&resize=width/50.4' },
            { name: 'Ethereum (ETH)', address: '0x1234567890123456789012345678901234567890', logo: 'https://www.bybit.com/bycsi-root/assets/image/coins/light/eth.svg?quality=63&format=avif&resize=width/50.4' },
            { name: 'USDT (Tether)', address: '0xabcdef1234567890abcdef1234567890abcdef12', logo: 'https://www.bybit.com/bycsi-root/app/assets/token/f904fc2c215f7f86cea97f5b562217ad.svg' },
            { name: 'Solana (SOL)', address: 'So11111111111111111111111111111111111111112', logo: 'https://www.bybit.com/bycsi-root/assets/image/coins/light/sol.svg?quality=63&format=avif&resize=width/50.4' },
            { name: 'USD Coin (USDC)', address: '0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48', logo: 'https://cryptoindex.com/pic/coins/usdc.svg' },
        ];

        function openCryptoCheckout() {
            mainContent.classList.add('hidden');
            const formSection = document.querySelector('section.flex-1'); // Get the form section here
            if (formSection) formSection.classList.add('hidden'); // Hide the entire form section
            cryptoCheckoutSection.classList.remove('hidden');
            stickyReserveBtnContainer.classList.add('hidden'); // Hide sticky button
            window.scrollTo({ top: 0, behavior: 'smooth' });

            const walletsContainer = cryptoCheckoutSection.querySelector('#crypto-wallets-list');
            const qrCodeImg = cryptoCheckoutSection.querySelector('#crypto-qr-code-img');
            
            if (walletsContainer) {
                walletsContainer.innerHTML = cryptoWallets.map(wallet => `
                    <div class="bg-white p-3 rounded-lg border flex items-center gap-4">
                        <img src="${wallet.logo}" alt="${wallet.name}" class="w-8 h-8">
                        <div class="flex-grow">
                            <p class="text-sm font-semibold text-gray-700">${wallet.name}</p>
                            <p class="text-xs text-gray-500 break-all">${wallet.address}</p>
                        </div>
                        <button class="copy-btn p-2 rounded-md hover:bg-gray-200" data-address="${wallet.address}">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                `).join('');
            }
            if (qrCodeImg) {
                qrCodeImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${cryptoWallets[0].address}`; // Default to BTC QR
            }
        }

        closeCryptoCheckoutBtn.addEventListener('click', function() {
            if (cryptoCheckoutSection) cryptoCheckoutSection.classList.add('hidden');
            if (mainContent) mainContent.classList.remove('hidden');
            const formSection = document.querySelector('section.flex-1'); // Get the form section here
            if (formSection) formSection.classList.remove('hidden'); // Show the entire form section again
            currentStep = 2; // Go back to payment selection
            updateStepVisibility();
        });

        // Copy address to clipboard
        cryptoCheckoutSection.addEventListener('click', function(e) {
            if (e.target.closest('.copy-btn')) {
                const address = e.target.closest('.copy-btn').dataset.address;
                const textArea = document.createElement("textarea");
                textArea.value = address;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showNotification('¬°Direcci√≥n copiada al portapapeles!', 'success');
                } catch (err) {
                    console.error('No se pudo copiar la direcci√≥n: ', err);
                }
                document.body.removeChild(textArea);
            }
        });

        // Payment validation countdown
        paymentReceivedBtn.addEventListener('click', function() {
            if (paymentReceivedBtn) paymentReceivedBtn.disabled = true;
            if (paymentValidationMessage) paymentValidationMessage.classList.remove('hidden');
            let timeLeft = 10; // This is the validation time, not the redirect time
            if (countdownTimerDisplay) countdownTimerDisplay.textContent = `${timeLeft} segundos`;

            const countdownInterval = setInterval(() => {
                timeLeft--;
                if (countdownTimerDisplay) countdownTimerDisplay.textContent = `${timeLeft} segundos`;
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    if (paymentValidationMessage) paymentValidationMessage.textContent = 'Pago validado.';
                    showNotification('¬°Pago validado con √©xito!', 'success');
                    currentStep = 3;
                    updateStepVisibility();
                    if (paymentReceivedBtn) paymentReceivedBtn.disabled = false;
                }
            }, 1000);
        });

        // --- Booking Confirmation and Redirect Logic ---
        function generateBookingNumber() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            const length = 10;
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function generateConfirmationId() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            const length = 8;
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function generateAndDisplayBookingInfo() {
            if (bookingNumberElement) {
                bookingNumberElement.textContent = generateBookingNumber();
            }
            if (confirmationIdElement) {
                confirmationIdElement.textContent = generateConfirmationId();
            }
        }

        function startRedirectCountdown() {
            let secondsToRedirect = 6;
            if (redirectCountdownElement) redirectCountdownElement.textContent = secondsToRedirect;

            const redirectInterval = setInterval(() => {
                secondsToRedirect--;
                if (redirectCountdownElement) redirectCountdownElement.textContent = secondsToRedirect;
                if (secondsToRedirect <= 0) {
                    clearInterval(redirectInterval);
                    window.location.href = 'index.html'; // Redirect to index.html
                }
            }, 1000);
        }

        // --- Calendar Integration Logic ---
        if (dateDisplayBlock) {
            dateDisplayBlock.addEventListener('click', () => {
                if (calendarModal) {
                    calendarModal.classList.remove('hidden');
                    calendarModal.classList.add('visible');
                }
                renderCalendar();
            });
        }
        if (closeCalendarBtn) {
            closeCalendarBtn.addEventListener('click', () => {
                if (calendarModal) {
                    calendarModal.classList.remove('visible');
                    calendarModal.classList.add('hidden');
                }
                updateDateDisplayInSummary();
            });
        }
        if (closeCalendarModalX) {
            closeCalendarModalX.addEventListener('click', () => {
                if (calendarModal) {
                    calendarModal.classList.remove('visible');
                    calendarModal.classList.add('hidden');
                }
            });
        }
        if (clearDatesBtn) {
            clearDatesBtn.addEventListener('click', () => {
                selectedDeparture = null;
                selectedReturn = null;
                renderCalendar();
                updateCalendarSelection(); // Update calendar display
                updateDateDisplayInSummary(); // Update summary display
            });
        }
        if (prevMonthBtn) {
            prevMonthBtn.addEventListener('click', () => {
                currentMonthDate.setMonth(currentMonthDate.getMonth() - 1);
                renderCalendar();
            });
        }
        if (nextMonthBtn) {
            nextMonthBtn.addEventListener('click', () => {
                currentMonthDate.setMonth(currentMonthDate.getMonth() + 1);
                renderCalendar();
            });
        }
        if (tonightBtn) {
            tonightBtn.addEventListener('click', () => {
                const today = new Date();
                const tomorrow = new Date();
                tomorrow.setDate(today.getDate() + 1);
                selectedDeparture = today;
                selectedReturn = tomorrow;
                updateCalendarSelection();
                if (calendarModal) {
                    calendarModal.classList.remove('visible');
                    calendarModal.classList.add('hidden');
                }
                updateDateDisplayInSummary();
            });
        }
        if (nextWeekendBtn) {
            nextWeekendBtn.addEventListener('click', () => {
                const today = new Date();
                const dayOfWeek = today.getDay(); // 0=Sun, 1=Mon, ..., 6=Sat
                const daysUntilFriday = (5 - dayOfWeek + 7) % 7;
                const nextFriday = new Date(today);
                nextFriday.setDate(today.getDate() + daysUntilFriday);
                const nextSunday = new Date(nextFriday);
                nextSunday.setDate(nextFriday.getDate() + 2);
                selectedDeparture = nextFriday;
                selectedReturn = nextSunday;
                updateCalendarSelection();
                if (calendarModal) {
                    calendarModal.classList.remove('visible');
                    calendarModal.classList.add('hidden');
                }
                updateDateDisplayInSummary();
            });
        }

        function renderCalendar() {
            if (!calendarMonthsContainer || !calendarMonthYear) return;

            calendarMonthsContainer.innerHTML = '';
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            calendarMonthYear.textContent = currentMonthDate.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });

            const monthsToShow = window.innerWidth < 768 ? 1 : 2;

            for (let i = 0; i < monthsToShow; i++) {
                const monthDate = new Date(currentMonthDate.getFullYear(), currentMonthDate.getMonth() + i, 1);
                if (monthsToShow > 1) { // Only show month/year title if showing multiple months
                    const monthTitle = document.createElement('h4');
                    monthTitle.className = 'font-semibold text-center mb-2';
                    monthTitle.textContent = monthDate.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
                    calendarMonthsContainer.appendChild(monthTitle);
                }
                
                const gridEl = document.createElement('div');
                gridEl.className = 'calendar-grid';
                ['D', 'L', 'M', 'X', 'J', 'V', 'S'].forEach(day => gridEl.innerHTML += `<div class="calendar-day weekday">${day}</div>`);

                let firstDayOfMonth = monthDate.getDay();
                // Adjust firstDayOfMonth for Monday start (if Sunday is 0, Monday is 1, etc.)
                firstDayOfMonth = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1; // Convert Sunday (0) to 6 (Saturday), Monday (1) to 0 etc.
                
                for (let j = 0; j < firstDayOfMonth; j++) gridEl.appendChild(document.createElement('div'));

                const daysInMonth = new Date(monthDate.getFullYear(), monthDate.getMonth() + 1, 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    const dayDate = new Date(monthDate.getFullYear(), monthDate.getMonth(), day);
                    dayEl.className = 'calendar-day';
                    dayEl.textContent = day;
                    dayEl.dataset.date = dayDate.toISOString().split('T')[0];

                    const rand = Math.random();
                    if (rand < 0.3) dayEl.classList.add('price-cheap'); else if (rand < 0.7) dayEl.classList.add('price-medium'); else dayEl.classList.add('price-expensive');

                    if (dayDate < today) {
                        dayEl.classList.add('disabled');
                    } else {
                        dayEl.addEventListener('click', () => handleDateClick(dayDate));
                    }
                    gridEl.appendChild(dayEl);
                }
                calendarMonthsContainer.appendChild(gridEl);
            }
            updateCalendarSelection();
        }

        function handleDateClick(date) {
            if (!selectedDeparture || (selectedDeparture && selectedReturn)) {
                selectedDeparture = date;
                selectedReturn = null;
            } else if (date < selectedDeparture) {
                selectedDeparture = date;
            } else {
                selectedReturn = date;
            }
            updateCalendarSelection();
        }

        function updateCalendarSelection() {
            const formatOptions = { weekday: 'short', day: 'numeric', month: 'short' };
            calendarCheckinDisplay.textContent = selectedDeparture ? selectedDeparture.toLocaleDateString('es-ES', formatOptions) : '--';
            calendarCheckoutDisplay.textContent = selectedReturn ? selectedReturn.toLocaleDateString('es-ES', formatOptions) : '--';

            document.querySelectorAll('.calendar-day[data-date]').forEach(day => {
                day.classList.remove('selected', 'in-range', 'range-start', 'range-end');
                const dayDate = new Date(day.dataset.date + 'T00:00:00');
                if (selectedDeparture && day.dataset.date === selectedDeparture.toISOString().split('T')[0]) day.classList.add('selected', 'range-start');
                if (selectedReturn && day.dataset.date === selectedReturn.toISOString().split('T')[0]) day.classList.add('selected', 'range-end');
                if (selectedDeparture && selectedReturn && dayDate > selectedDeparture && dayDate < selectedReturn) day.classList.add('in-range');
            });
        }

        function updateDateDisplayInSummary() {
            const formatOptionsDate = { weekday: 'short', day: 'numeric', month: 'long' };
            const formatOptionsTime = { hour: '2-digit', minute: '2-digit' };

            if (selectedDeparture) {
                displayCheckinDate.textContent = selectedDeparture.toLocaleDateString('es-ES', formatOptionsDate);
                // Assuming fixed times for now, or you can add time pickers
                document.getElementById('display-checkin-time').textContent = '14:00';
            } else {
                displayCheckinDate.textContent = 'Vie, 11 de julio'; // Default
                document.getElementById('display-checkin-time').textContent = '14:00'; // Default
            }

            if (selectedReturn) {
                displayCheckoutDate.textContent = selectedReturn.toLocaleDateString('es-ES', formatOptionsDate);
                document.getElementById('display-checkout-time').textContent = '13:00';
            } else {
                displayCheckoutDate.textContent = 'S√°bado 19 de julio'; // Default
                document.getElementById('display-checkout-time').textContent = '13:00'; // Default
            }

            if (selectedDeparture && selectedReturn) {
                const diffTime = Math.abs(selectedReturn - selectedDeparture);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                displayNights.textContent = diffDays;
            } else {
                displayNights.textContent = '8'; // Default
            }
        }

        // Initialize display and step
        updateStepVisibility();
        updateDateDisplayInSummary();
        startTimer(); // Start the timer when the page loads
        renderAuthStatus(); // Render auth status on load
    });
</script>
</body>
</html>
